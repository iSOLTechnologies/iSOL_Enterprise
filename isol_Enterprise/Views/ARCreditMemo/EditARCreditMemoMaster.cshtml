@{
     ViewBag.title1 = "AR Credit Memo / ";
    ViewBag.title2 = "Edit";
    ViewData["Title"] = "EditSaleOrderMaster";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using System.Data
@model DataSet

@using Microsoft.AspNetCore.Http

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

<!-- Render Body <Start> -->

<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <!--begin::Subheader-->
    <!--end::Subheader-->
    <!--begin::Entry-->
    <div class="container">
        <!--begin::Card-->
        <div class="card card-custom card-sticky" id="kt_page_sticky_card">
            <div class="card-header">
                <div class="card-title">
                    <h3 class="card-label">
                        Edit AR Credit Memo
                        <i class="mr-2"></i>
                        <!-- <small class="">try to scroll the page</small> -->
                    </h3>
                </div>
                <div class="card-toolbar">
                   <a onclick="Back_his()" class="btn btn-light-primary font-weight-bolder mr-2">
                        <i class="ki ki-long-arrow-back icon-sm"></i>Back
                    </a>
                    <div class="btn-group">

                        <button type="button" class="btn btn-primary font-weight-bolder" disabled id="btnSaveData">
                            <i class="ki ki-check icon-sm"></i>Update
                        </button>
                        @*<button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>*@
                        @*   <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                        <ul class="nav nav-hover flex-column">
                        <li class="nav-item">
                        <a href="#" class="nav-link">
                        <i class="nav-icon flaticon2-reload"></i>
                        <span class="nav-text">Save &amp; continue</span>
                        </a>
                        </li>
                        <li class="nav-item">
                        <a href="#" class="nav-link">
                        <i class="nav-icon flaticon2-add-1"></i>
                        <span class="nav-text">Save &amp; add new</span>
                        </a>
                        </li>
                        <li class="nav-item">
                        <a href="#" class="nav-link">
                        <i class="nav-icon flaticon2-power"></i>
                        <span class="nav-text">Save &amp; exit</span>
                        </a>
                        </li>
                        </ul>
                        </div>*@
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!--begin::Form-->
                <form class="form" id="kt_form">


                    <input type="hidden" value="@Context.Session.GetString("Name")" id="sessionName" />
                    <input type="hidden" value="@Context.Session.GetString("Email")" id="sessionEmail" />
                    <input type="hidden" value="@Context.Session.GetString("RoleCode")" id="UserRoleCode" />
                    <input type="hidden" value="@Context.Session.GetString("DepartmentCode")" id="_DepartmentCode" />

                    <input type="hidden" value="@Context.Request.Query["Id"]" id="Guid" />
                    <input type="hidden" value="@Context.Request.Query["Source"]" id="PageGuid" />
                    <input type="hidden" value="@Context.Request.Query["DocType"]" id="DocType" />
                    <input type="hidden" value="@Context.Request.Query["DOM"]" id="DOMStatus" />

                    <input type="hidden" value="@Context.Session.GetInt32("UserId")" id="_UserId" />
                    <style>
                        .mr2 {
                            margin: 0% 2% 0% 2%;
                            /*width: 5%;*/
                        }

                        .cr2 {
                            margin: 0% 1% 0% 0%;
                            width: 5%;
                        }

                        .wdth {
                            width: 250% !important;
                        }

                        /*tr > th {
                                                    text-align: left;
                                                    width: 50px !important;
                                                }
                                                table {
                                                   display: table-cell;
                                                    text-align:center;
                                                    overflow-x: auto;
                                                    white-space: nowrap;
                                                }

                                                tr > td {
                                                    text-align: center;
                                                    width: 5% !important;
                                                }*/
                        #kt_repeater_1 {
                            border-collapse: collapse;
                            width: 100%;
                            overflow-x: scroll;
                            display: block;
                        }

                        .ScrollThead,
                        .ScrollTbody {
                            display: inline-block;
                        }

                        .ScrollTbody {
                            overflow-y: auto;
                            overflow-x: hidden;
                            max-height: 300px;
                        }

                            .ScrollTbody td, .ScrollThead
                            th {
                                min-width: 160px;
                                max-width: 160px;
                                height: 40px;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            }

                        .ScrollTbody2 td, .ScrollThead2
                        th {
                            min-width: 100px;
                            max-width: 160px;
                            height: 40px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }
                    </style>
                    <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">
                        <div class="row">
                            <div class="col-lg-12">
                                <!--begin::Portlet-->
                                <div class="kt-portlet kt-portlet--last kt-portlet--head-lg kt-portlet--responsive-mobile" id="kt_page_portlet">

                                    <div class="kt-portlet__body">
                                        <form autocomplete="off" role="form" class="kt-form" id="F_@Context.Request.Query" name="F_@Context.Request.Query["Source"]">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <div class="kt-section kt-section--first">
                                                        <div class="kt-section__body">


                                                            @* ----------   Header -----------*@
                                                            @foreach (DataRow row in Model.Tables[0].Rows)
                                                            {
                                                                <input value="@row["Id"]" type="text" hidden id="my_id">

                                                                <div id="HeaderForm">
                                                                    <div class="form-group row">

                                                                        <div class="col-md-6">
                                                                            <label>Customer</label>
                                                                            @*<input disabled type="text" class="form-control form-control-sm" >*@
 <div class="input-group">
                                                                            <input readonly value="@row["CardCode"]" readonly type="text" id="CardCode" class="form-control form-control-sm" placeholder="Customer" aria-describedby="basic-addon2">
                                                                            @*<div id="CustomerNo" class="input-group-append">
                                                                                <span class="input-group-text">
                                                                                    <i class="la la-search"></i>
                                                                                </span>
                                                                            </div>*@
                                                                        </div>
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>

                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label>No.</label>
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <select id="Series" class="form-control NotReq">

                                                                                        @foreach (iSOL_Enterprise.Models.Sale.tbl_series i in ViewBag.GetSeries)
                                                                                        {

                                                                                            if (row["Series"].Equals(i.Series))
                                                                                            {
                                                                                                <option value="@i.Series" selected>@i.SeriesName </option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value="@i.Series">@i.SeriesName </option>
                                                                                            }

                                                                                        }


                                                                                    </select>
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <input id="DocNum" value="@row["DocNum"]" readonly type="text" class="form-control form-control-sm" placeholder="No.">
                                                                                </div>

                                                                            </div>

                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <div class="col-md-6">
                                                                            <label>Name</label>
                                                                            <input readonly value="@row["CardName"]" type="text" id="CardName" class="form-control form-control-sm" placeholder="Name">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label>Status</label>
                                                                            <input disabled type="text" id="Status" class="form-control form-control-sm" value="Open">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                    </div>


                                                                    <div class="form-group row">
                                                                        <div class="col-md-6">
                                                                            <label>Contact Person</label>
                                                                            <script>
                                                                                var CntctPerson = `@row["CardCode"]`
                                                                            </script>
                                                                            <select class=" form-control kt-select2 ItemCode NotReq" id="CntcCode" name="param">
                                                                                <option value="" disabled selected>Select</option>
                                                                                <!-- @* @foreach (var item in Model.ListItemMaster)
                                                                             {
                                                                                 <option value="@item.ItemCode">@item.FrgnName @item.ItemName </option>
                                                                             }*@ -->
                                                                            </select>
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label>Posting Date</label>
                                                                            <input id="DocDate" value="@(((DateTime)row["DocDate"]).ToString("yyyy-MM-dd"))" type="date" class="form-control form-control-sm" placeholder="Posting Date">
                                                                            @*<input id="DocDate" type="date" class="form-control " >*@
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                    </div>


                                                                    <div class="form-group row">
                                                                        <div class="col-md-6">
                                                                            <label>Customer Ref. No.</label>
                                                                            <input type="text" value="@row["NumAtCard"]" id="NumAtCard" class="form-control form-control-sm" placeholder="Ref no.">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label>Delivery Date</label>
                                                                            <input id="DocDueDate" value="@(((DateTime)row["DocDueDate"]).ToString("yyyy-MM-dd"))" type="date" class="form-control form-control-sm" placeholder="Valid until">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group row">


                                                                        <div class="col-md-6">
                                                                            <label>Currency</label>
                                                                             <select id="DocCur" class="form-control form-control-sm ">

                                                                 @foreach (iSOL_Enterprise.Models.sale.tbl_currency x in ViewBag.Currency)
                                                                {
                                                                    if (row["DocCur"].Equals(x.curr_code))
                                                                    {
                                                                        <option selected value="@x.curr_code">@x.curr_name</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@x.curr_code">@x.curr_name</option>
                                                                    }
                    
                    
                                                                }
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <label>Document Date</label>
                                                                            <input id="TaxDate" value="@(((DateTime)row["TaxDate"]).ToString("yyyy-MM-dd"))" type="date" class="form-control form-control-sm" placeholder="Date">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group row">
                                                                        <div class="col-md-6">
                                                                            <label>Challan #</label>
                                                                            <input id="ChallanNo" value="@row["ChallanNo"]" type="number" class="form-control form-control-sm NotReq">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label>Sale Order #</label>
                                                                            <select id="SaleOrderNo" class="form-control form-control-sm NotReq">
                                                                                <option guid='' value=''> Select Order </option>
                                                                                @foreach (iSOL_Enterprise.Models.SalesQuotation_MasterModels SaleOrder in ViewBag.SaleOrderList)
                                                                                {
                                                                                    if (row["SaleOrderNo"].Equals(SaleOrder.Id))
                                                                                    {
                                                                                        <option value="@SaleOrder.Id" selected>@SaleOrder.DocNum</option>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <option value="@SaleOrder.Id">@SaleOrder.DocNum</option>
                                                                                    }
                                                                                }

                                                                            </select>
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>

                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <div class="col-md-6">
                                                                            <label>Purchase Type</label>
                                                                            <select id="PurchaseType" class="form-control form-control-sm NotReq">
                                                                                <option value="0"> Order Base</option>
                                                                                <option value="1"> General</option>
                                                                            </select>
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                        <script>
                                                                            var select = document.getElementById("PurchaseType");
                                                                            select.selectedIndex = @row["PurchaseType"];
                                                                        </script>
                                                                        <div class="col-md-6">
                                                                            <label>Type Detail</label>
                                                                            <select id="TypeDetail" class="form-control form-control-sm NotReq">
                                                                                <option value="">Select Type Detail</option><option value="01">Accessories</option>
                                                                                <option value="02"> Yarn</option>
                                                                                <option value="03"> IT</option>
                                                                                <option value="04"> General</option>
                                                                                <option value="05"> Engineering</option>
                                                                                <option value="06"> Weaving</option>
                                                                                <option value="07"> Dyeing</option>
                                                                                <option value="08"> Stiching</option>
                                                                                <option value="09"> Fabric</option>
                                                                                <option value="10"> Embroidery</option>
                                                                                <option value="11"> Cartage Expense</option>
                                                                                <option value="12"> Rolling</option>
                                                                                <option value="13"> Shearing</option>
                                                                                <option value="14"> Quilting</option>
                                                                                <option value="15"> Starching</option>
                                                                                <option value="16"> Printing</option>
                                                                                <option value="17"> Washing</option>
                                                                                <option value="18"> Seersucker</option>
                                                                                <option value="19"> Sanforized</option>
                                                                                <option value="20"> Die Cutting</option>
                                                                            </select>
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                        <script>
                                                                            var select = document.getElementById("TypeDetail");
                                                                            select.selectedIndex = @row["TypeDetail"];
                                                                        </script>
                                                                    </div>

                                                                    <div class="form-group row">
                                                                        <div class="col-md-4">
                                                                            <label>Container #</label>
                                                                            <input id="ContainerNo" value="@row["ContainerNo"]" type="number" class="form-control form-control-sm NotReq">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label>Manual Gate Pass #</label>
                                                                            <input id="ManualGatePassNo" value="@row["ManualGatePassNo"]" type="number" class="form-control form-control-sm NotReq">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label>Production Order #</label>
                                                                            <input id="ProductionOrderNo" type="number" value="@row["ProductionOrderNo"]" class="form-control form-control-sm NotReq">
                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="kt-separator kt-separator--space-md kt-separator--border-dashed"></div>




                                                                <ul class="nav nav-tabs nav-tabs-line nav-tabs-bold nav-tabs-line-3x nav-tabs-line-brand" role="tablist">
                                                                    <li class="nav-item">
                                                                        <a class="nav-link active" data-toggle="tab" href="#kt_tabs_contents" role="tab">Contents</a>
                                                                    </li>
                                                                    <li class="nav-item">
                                                                        <a class="nav-link" data-toggle="tab" id="tabAccounting" href="#kt_tabs_acct" role="tab">Accounting</a>
                                                                    </li>
                                                                    <li class="nav-item">
                                                                        <a class="nav-link" data-toggle="tab" href="#kt_tabs_attachment" role="tab">Attachment</a>
                                                                    </li>

                                                                </ul>
                                                                <div class="tab-content">

                                                                    <div class="tab-pane active" id="kt_tabs_contents" role="tabpanel">







                                                                        <div class="form-group row col-md-4 mt-3">
                                                                            <label for="staticEmail" class="col-sm-6 col-form-label font-weight-bold"> Item/Service Type</label>
                                                                            <div class="col-sm-6">


                                                                                @if (row["DocType"].Equals("I"))
                                                                                {
                                                                                    <select id="ItemServiceType" class="form-control">
                                                                                        <option selected value="1">Item</option>
                                                                                        @*<option value="2">Service</option>*@
                                                                                    </select>
                                                                                    <script>

                                                                                        var Doctype = "1";
                                                                                    </script>
                                                                                }
                                                                                else if (row["DocType"].Equals("S"))
                                                                                {
                                                                                    <select id="ItemServiceType" class="form-control">
                                                                                        @*<option value="1">Item</option>*@
                                                                                        <option selected value="2">Service</option>
                                                                                    </select>
                                                                                    <script>

                                                                                        var Doctype = "2";
                                                                                    </script>
                                                                                }


                                                                            </div>
                                                                        </div>





                                                                        <div id="kt_tabs_5_1">

                                                                            <table id="kt_repeater_1" style="overflow:auto">
                                                                                <thead class="ScrollThead">
                                                                                    <tr>

                                                                                        <th>Line Num</th>
                                                                                        <th>Item No.</th>
                                                                                        <th>Item Name</th>
                                                                                        <th>Warehouse</th>
                                                                                        <th>QTY in Warehouse</th>
                                                                                        <th>Quantity</th>
                                                                                        <th>BaseQty</th>
                                                                                        <th>OpenQty</th>
                                                                                        <th>Unit Price</th>
                                                                                        <th>Discount %</th>
                                                                                        <th>Tax Code</th>
                                                                                        <th>Total (LC)</th>
                                                                                        <th>UOM Code</th>
                                                                                        @*<th>Country / Region of origin</th>*@
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody id="ListParameters" data-repeater-list="" class="ScrollTbody">
                                                                                    @if (row["DocType"].Equals("I"))
                                                                                    {
                                                                                        @foreach (DataRow row1 in Model.Tables[1].Rows)
                                                                                        {

                                                                                            <tr class="rowItemDetail align-items-center itm">
                                                                                                <td>
                                                                                                    <input
                                                                                                        disabled
                                                                                                        id="LineNum" value="@row1["LineNum"]" class="form-control form-control-sm" type="text">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <div class="input-group">
                                                                                                        <input id="ItemCode"
                                                                                                   disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                            value="@row1["ItemCode"]" type="text" class="form-control form-control-sm" placeholder="Item No." aria-describedby="basic-addon2">
                                                                                                        <div id="Itemno" class="input-group-append @(Convert.ToString(ViewBag.Status) == "Closed" ? "d-none" :"") " style="pointer-events: @(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? "none" : "") ;">
                                                                                                            <span class="input-group-text">
                                                                                                                <i class="la la-search"></i>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>

                                                                                                <td>
                                                                                                    <input
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        id="ItemName" value="@row1["ItemName"]" class="form-control form-control-sm" type="text">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <div class="input-group">
                                                                                                        <select disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                               
                                                                                               class="form-control" id="Warehouse">
                                                                                               
                                                                                                        @foreach (iSOL_Enterprise.Models.sale.tbl_OWHS warehouse in  ViewBag.Warehouse)
                                                                                                        {
                                                                                                            if (row1["WhsCode"].Equals(warehouse.whscode))
                                                                                                            {
                                                                                                                <option  value="@warehouse.whscode" selected>@warehouse.whsname</option>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                <option  value="@warehouse.whscode" >@warehouse.whsname</option> 
                                                                                                            }


                                                                                                        }


                                                                                                        </select>
                                                                                                        <div id="ListbtnSelectBatch" class="input-group-append d-none ">
                                                                                                            <span class="input-group-text">
                                                                                                                <i class="la la-warehouse batch_is_valid"></i>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>


                                                                                                </td>
                                                                                                 
                                                                                                <td>
                                                                                                    <input id="onHand"  
                                                                                                        class="form-control form-control-sm" readonly type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td> 

                                                                                                <td>
                                                                                                    <input 
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        value="@row1["Quantity"]" class="form-control form-control-sm" id="QTY" type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input readonly class="form-control form-control-sm NotReq" id="BaseQty" value="@row1["BaseQty"]" type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input readonly class="form-control form-control-sm NotReq" id="OpenQty"  type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        value="@row1["price"]" class="form-control form-control-sm" id="UPrc" type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        value="@row1["DiscPrcnt"]" class="form-control form-control-sm NotReq" id="DicPrc" type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    @*<input class="form-control form-control-sm" value="@row1["VatGroup"]" type='number' disabled>*@

                                                                                                    <select 
                                                                                                        
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        class="form-control vtGroup" id="VatGroup">

                                                                                                        @foreach (var ii in ViewBag.Taxes)
                                                                                                        {
                                                                                                            if (row1["VatGroup"].Equals(ii.code))
                                                                                                            {
                                                                                                                <option class="VT_Option" selected guid="@ii.Rate" value="@ii.code">@ii.vatName </option>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                <option class="VT_Option" guid="@ii.Rate" value="@ii.code">@ii.vatName </option>
                                                                                                            }


                                                                                                        }
                                                                                                    </select>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>

                                                                                                    <input 
                                                                                                        disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                        value="@row1["LineTotal"]" class="form-control form-control-sm" id="TtlPrc" name="TotalLC" type='number' disabled>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <select disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)" class="form-control " id="UomEntry"></select><input id="UomCode" class="position-absolute d-none" />

                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                              <td class="d-none">
                                                                                                    @*<input class="form-control  value="@row1["CountryOrg"]" form-control-sm" id="CountryOrg">*@



                                                                                                    <select disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                class="form-control vtGroup" id="CountryOrg">


                                                                                                        @foreach (var j in ViewBag.Countries)
                                                                                                        {
                                                                                                            if (row1["CountryOrg"].Equals(j.country_code))
                                                                                                            {
                                                                                                                <option selected value="@j.country_code">@j.country_name </option>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                <option value="@j.country_code">@j.country_name </option>
                                                                                                            }


                                                                                                        }
                                                                                                    </select>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td class="d-none"> 
                                                                                                    <input 
                                                                                                    disabled="@(Convert.ToInt32(row1["OpenQty"] == null?0:row1["OpenQty"])  <= 0 ? true : false)"
                                                                                                    value="@row1["Quantity"]" class="form-control form-control-sm" id="OldQty"  type="number">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                            </tr>
                                                                                        }
                                                                                    }
                                                                                   
                                                                                </tbody>
                                                                            </table>


                                                                            <div style="margin-top:1%" class="form-group form-group-last row">
                                                                                <div class="col-md-6">
                                                                                    <button type="button" id="ListBtnAddd" data-repeater-create="" class="btn btn-light-primary font-weight-bold btn-sm">
                                                                                        <i class="la la-plus"></i> Add
                                                                                    </button>
                                                                                </div>
                                                                            </div>

                                                                        </div>


                                                                        <div id="kt_tabs_5_2">

                                                                            <table id="kt_repeater_2" style="overflow:auto">
                                                                                <thead class="ScrollThead2">
                                                                                    <tr>
                                                                                        <th>Description</th>
                                                                                        <th>Gl Account</th>
                                                                                        <th>Gl Account Name</th>
                                                                                        <th>Tax Code</th>
                                                                                        <th>Total LC</th>
                                                                                        <th>Blanket Agreement No.</th>

                                                                                        <!-- @*<th>Supplier </th>
                                                                                    <th>Lot Number</th>
                                                                                    <th>GSM</th>*@ -->
                                                                                        <th></th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody id="ListParameters2" data-repeater-list="" class="ScrollTbody2">
                                                                                    @if (row["DocType"].Equals("S"))
                                                                                    {
                                                                                        @foreach (DataRow row2 in Model.Tables[1].Rows)
                                                                                        {

                                                                                            <tr class="rowItemDetail align-items-center itm">

                                                                                                <td>
                                                                                                    <input id="Dscription" value="@row2["Dscription"]" class="form-control form-control-sm">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <div class="input-group">
                                                                                                        <input type="text" value="@row2["AcctCode"]" id="AcctCode" class="form-control form-control-sm" placeholder="GL Account" aria-describedby="basic-addon2">
                                                                                                        <div id="GLAccountNo" class="input-group-append">
                                                                                                            <span class="input-group-text">
                                                                                                                <i class="la la-search"></i>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input id="AcctName" class="form-control form-control-sm">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    @*<input value="@row2["VatGroup"]" class="form-control form-control-sm">*@
                                                                                                    <select class="form-control" id="VatGroup2">

                                                                                                        @foreach (var ii in ViewBag.Taxes)
                                                                                                        {
                                                                                                            if (row2["VatGroup"].Equals(ii.code))
                                                                                                            {
                                                                                                                <option selected guid="@ii.Rate" value="@ii.code">@ii.vatName </option>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                <option guid="@ii.Rate" value="@ii.code">@ii.vatName </option>
                                                                                                            }


                                                                                                        }
                                                                                                    </select>
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input value="@row2["LineTotal"]" class="form-control form-control-sm" id="TotalLC">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                                <td>
                                                                                                    <input class="form-control form-control-sm" id="BlanketAgreementNo">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                                </td>
                                                                                            </tr>
                                                                                        }

                                                                                    }
                                                                                    
                                                                                </tbody>
                                                                            </table>
                                                                            <div style="margin-top:1%" class="form-group form-group-last row">
                                                                                <div class="col-md-6">
                                                                                    <button type="button" id="ListBtnAddRM" data-repeater-create="" class="btn btn-light-primary font-weight-bold btn-sm">
                                                                                        <i class="la la-plus"></i> Add
                                                                                    </button>

                                                                                    <!-- <button type="button" class="btn btn-light-primary font-weight-bold btn-sm">Setup login verification</button> -->


                                                                                </div>
                                                                            </div>

                                                                        </div>

                                                                    </div>

                                                                    <div class="tab-pane" id="kt_tabs_acct" role="tabpanel">


                                                                        <div class="form-group row col-md-4 mt-3">
                                                                            <label for="staticEmail" class="col-sm-6 col-form-label font-weight-bold">Payment Terms</label>
                                                                            <div class="col-sm-6">
                                                                                @foreach (DataRow row11 in Model.Tables[0].Rows)
                                                                                {
                                                                                    <select class="form-control" id="GroupNum">

                                                                                        @foreach (var k in ViewBag.Payments)
                                                                                        {
                                                                                            if (row11["GroupNum"].ToString() == k.GroupNum.ToString())
                                                                                            {
                                                                                                <option selected value="@k.GroupNum">@k.PymntGroup</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value="@k.GroupNum">@k.PymntGroup </option>
                                                                                            }


                                                                                        }
                                                                                    </select>
                                                                                }
                                                                            </div>
                                                                        </div>





                                                                    </div>

                                                                    <div class="tab-pane" id="kt_tabs_attachment" role="tabpanel">




                                                                        <table id="kt_repeater_3" style="overflow:auto">
                                                                            <thead class="ScrollThead2">
                                                                                <tr>
                                                                                    <th>TargetPath</th>
                                                                                    <th>FileName</th>
                                                                                    <th>AttachmentDate</th>
                                                                                    <th></th>
                                                                                    <th></th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody id="ListParameters3" data-repeater-list="" class="ScrollTbody2">
                                                                                <tr class="rowItemDetail align-items-center itm">

                                                                                    <td>
                                                                                        <input readonly type="file" id="selectedFile" class="position-absolute d-none form-control form-control-sm">
                                                                                        <input id="selectedFilePath" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input readonly id="selectedFileName" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input readonly id="selectedFileDate" type="date" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <button id="btnbrowseFile" type="button" class="btn btn-light-primary font-weight-bold btn-sm"> <i class="la la-plus"></i> Browse </button>

                                                                                    </td>


                                                                                </tr>
                                                                            </tbody>
                                                                        </table>

                                                                        <div style="margin-top:1%" class="form-group form-group-last row">
                                                                            <div class="col-md-6">
                                                                                <button type="button" id="ListBtnAddFile" data-repeater-create="" class="btn btn-light-primary font-weight-bold btn-sm">
                                                                                    <i class="la la-plus"></i> Add
                                                                                </button>

                                                                                <!-- <button type="button" class="btn btn-light-primary font-weight-bold btn-sm">Setup login verification</button> -->


                                                                            </div>
                                                                        </div>





                                                                    </div>

                                                                </div>

 




                                                        <div class="container" id="FooterData">
                                                            <br />
                                                            <br />
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <label for="" class="form-label">Sales Employee</label>
                                                                   @foreach(DataRow row11 in Model.Tables[0].Rows){
                                                                               
                                                                                <select id="SlpCode"  class="form-control form-control-sm">
                                                                                   @foreach (var k in ViewBag.SalesEmployee)
                                                                             {
                                                                                            if (row11["SlpCode"].ToString() == k.SlpCode.ToString())
                                                                                 {
                                                                                    <option selected  value="@k.SlpCode">@k.SlpName</option>
                                                                                 }else{
                                                                                    <option value="@k.SlpCode">@k.SlpName </option>
                                                                                 }
                                                                             
                                                                                       
                                                                             } 
                                                                            </select>
                                                                             }
                                                                </div>

                                                                <div class="col-md-6">
                                                                    <label for="inputEmail4" class="form-label">Total Before Discount</label>
                                                                    <input name="TotalBeforeDiscount" readonly type="text" class="form-control" id="TotalBeforeDiscount">

                                                                </div>

                                                            </div>
                                                            <br />
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <label for="inputPassword4" class="form-label">Owner</label>
                                                                    <input name="OwnerCode" type="text" class="form-control" id="OwnerCode">

                                                                </div>


                                                                <div class="col-md-6">
                                                                    <label for="inputEmail4" class="form-label">Discount %</label>
                                                                    <!-- @*@Html.EditorFor(m => m.OQUT_obj.DiscPrcnt, new { htmlAttributes = new { @class = "form-control", type = "number" } })*@ -->
                                                                            <div class="d-flex"><input name="Discount" value="@row["DiscPrcnt"]" type="number" class="form-control NotReq" id="Discount" style="margin-right: 1.2rem !important;"><input name="Discount" type="number" class="form-control NotReq" id="DiscountVal" readonly></div>

                                                                </div>

                                                            </div>
                                                            <br/>
                                                             <div class="row">


                                                                <div class="col-md-6  d-none">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" value="" id="RoundingChkBox">
                                                                        <label class="form-check-label" for="flexCheckDefault">
                                                                            Rounding
                                                                        </label>
                                                                    </div>
                                                                    <!-- @*  @Html.EditorFor(m => m.OQUT_obj.Rounding, new { htmlAttributes = new { @class = "form-control", type = "number" } })*@ -->
                                                                    <input type="number" class="form-control " readonly id="Rounding">

                                                                </div>

                                                                <div class="col-md-6">
                                                                    <label for="inputEmail4" class="form-label" id="">Tax</label>
                                                                    <input name="Tax" type="number" class="form-control" id="FooterTax" readonly>

                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label for="inputEmail4" class="form-label">Total</label>
                                                                    <input name="Total" readonly type="text" class="form-control" id="Total">
                                                                </div>
                                                            </div>
                                                            <br />
                                                            <div class="row">

 
                                                                <div class="col-md-6">
                                                                    <label for="inputRemarks" class="form-label">Remarks</label>

                                                                           <textarea id="Comments" class="form-control" rows="3">@row["Comments"]
                                                                    </textarea>
                                                                </div>
                                                            </div>
                                                            <hr />
                                                        </div>


                                                         }
                                                        
                                                        
                                                        </div>



                                                    </div>

                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <!--end::Portlet-->
                            </div>
                        </div>
                    </div>







                    <div class="modal fade" id="DefectPic" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display: none;">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Defect Pic</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <img style="width:765px" id="DefecPicUrl" src="">
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="myBatchAddmodal" role="dialog">
                        <div class="modal-dialog modal-dialog-centered modal-xl">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="card-title">Batches Setup</h5>
                                    <button type="button" class="close text-danger" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <!-- General Form Elements -->
                                    <div class="container">
                                        <div class="card-body" style="padding:0">
                                            <!--begin: Datatable-->

                                            <div id="kt_datatable_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                                                <div class="row">
                                                    <div class="col-sm-12 scrollbar mb-2 pb-2" style="overflow:auto">
                                                        <table id="rowsFromdocumentTable2" class="table-bordered">
                                                            <thead class="ScrollThead">
                                                                <tr>
                                                                    <th>Item No.</th>
                                                                    <th>Item Description</th>
                                                                    <th>WHse Code</th>
                                                                    <th>Quantity</th>
                                                                    <th>Total Needed</th>
                                                                    <th>Total Selected</th>
                                                                    <th>Total Batches</th>
                                                                    <th>Direction</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="ListParameters5" data-repeater-list="" class="ScrollTbody">
                                                                <tr class="rowItemDetail align-items-center itm">
                                                                    <td>
                                                                        <input id="adItemno" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adItemDesc" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adWarehouse" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adQuantity" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adTotalNeeded" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adTotalSelected" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adTotalBacthes" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="adDirection" readonly class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>

                                                                </tr>

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12 mt-3 BatchTableContainer scrollbar-ripe-malinka">
                                                        <!--begin: Datatable-->
                                                        <table class="table" id="MyyyyBatchAddTable" style="overflow:auto">
                                                            <thead class="ScrollThead2">
                                                                <tr>
                                                                    <th>Batch</th>
                                                                    <th>Qty</th>
                                                                    <th>ExpiryDate</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="ListParameters6" data-repeater-list="" class="ScrollTbody2">
                                                                <tr class="rowItemDetail align-items-center itm">

                                                                    <td>
                                                                        <div class="input-group">
                                                                            <input id="DistNumber" class="form-control form-control-sm">
                                                                            <div id="btnSearchBatch" class="input-group-append">
                                                                                <span class="input-group-text">
                                                                                    <i class="la la-search"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="BQuantity" class="form-control form-control-sm">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                    <td>
                                                                        <input id="ExpDate" type="date" class="form-control form-control-sm" placeholder="Valid until">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <div style="margin-top:1%" class="form-group form-group-last row">
                                                            <div class="col-md-6">
                                                                <button type="button" id="ListBtnAddBatch" data-repeater-create="" class="btn btn-light-primary font-weight-bold btn-sm">
                                                                    <i class="la la-plus"></i> Add
                                                                </button>
                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                            <!--end: Datatable-->
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-success mr-2" id="btnAddbatchTableOk"> Ok </button>
                                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="modal fade" id="myBatchSearchmodal" role="dialog">
                        <div class="modal-dialog modal-dialog-centered modal-md">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="card-title">Select Batch</h5>
                                    <button type="button" class="close text-danger" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <!-- General Form Elements -->
                                    <div class="container">
                                        <div class="card-body">
                                            <!--begin: Datatable-->

                                            <div id="kt_datatable_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <!--begin: Datatable-->
                                                        <table class="table table-striped- table-bordered table-hover table-checkable " id="myBatchSearchtable">
                                                            <thead>
                                                                <tr>
                                                                    <th></th>
                                                                    <th></th>

                                                                </tr>
                                                            </thead>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--end: Datatable-->
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">

                                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>



                </form>
                <!--end::Form-->
            </div>
        </div>
        <!--end::Card-->

    </div>
    <!--end::Entry-->
</div>
<!-- Render Body <End> -->
<script src="~/Assets/plugins/global/plugins.bundle.js"></script>
<script src="~/Assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
<script src="~/Assets/js/scripts.bundle.js"></script>
<script src="~/js/commonmethods.js"></script>
<script src="~/viewjs/batches/batchesin.js"></script>


<!-- Item Modal -->
@*<button type="button" style="display:none;" id="myItembtn" data-toggle="modal" data-target="#myModal"></button>

<partial name="~/Views/Shared/_ItemModal.cshtml" model='ViewData["ItemList"]'/>
 *@
<!-- Modal End -->
<!-- Customer Modal -->
@*<button type="button" style="display:none;" id="myCustomerbtn" data-toggle="modal" data-target="#myCustModal"></button>

<partial name="~/Views/Shared/_CustomerModal.cshtml" model='ViewData["CustomerList"]'/>
 *@
<!-- Modal End -->
<!-- Account Modal -->
@*<button type="button" style="display:none;" id="myAccountbtn" data-toggle="modal" data-target="#myaccountModal"></button>

<partial name="~/Views/Shared/_AccountModal.cshtml" model='ViewData["AccountList"]' />
 *@
<!-- Modal End -->

<script>
    var vatGroupData = "";
    var ItemServiceType = Doctype;
    var WareHouseData ="";

    const boxes = document.querySelectorAll('.d');
    for (const box of boxes) {
        box.value = new Date().toJSON().slice(0, 10);
    }



    $(document).on('click', '#GLAccountNo', function (e) {

        ObjAcctCode = $(this).closest('tr').find("#AcctCode");
        //var GLAccount = $(this).closest('#ListParameters2 .itm').find('#GLAccountNo');
        generateAccountTable();
        $('#myaccountModal').modal('show');
        console.log("Clickeddd")

    });
   @* $(document).on('click', '#tabAccounting', function (e) {

        $.get("SaleQuotation/GetPayments", function (data) {
            $("#GroupNum").html("");
            $.each(data, function () {

                $("#GroupNum").append($("<option />").val(this.groupNum).text(this.pymntGroup));
            });

        });

    });*@
    $(document).on('click', '#btnbrowseFile', function (e) {

        console.log("brow");
        let selectedrow = $(this).closest('tr');
        var input = selectedrow.find("#selectedFile");

        input.click();
        //debugger
        input.change(function () {
            var SelectedFile = input.val()
            selectedrow.find("#selectedFileDate").val(new Date().toJSON().slice(0, 10));
            selectedrow.find("#selectedFilePath").val(SelectedFile);
            selectedrow.find("#selectedFileName").val(SelectedFile.replace(/^.*[\\\/]/, ''));

            // AddRowInFileTable();

        });


        //$(ObjItemCode)
    });
    $(document).on('change', '#ItemServiceType', function (e) {
        var val = $("#ItemServiceType option:selected").val();
        var value = $('#ItemServiceType').val();
        ItemServiceType = value;
        if (value == '1') {


            const srs = document.querySelectorAll('#kt_tabs_5_2 #ListParameters2 .itm');

            for (const s of srs) {
                s.remove();

            }

            append_ServiceFirstRow();

            //$("#kt_tabs_5_2 #ListParameters2 .2nd_Services").remove();

            $("#kt_tabs_5_1").removeClass("d-none");
            $("#kt_tabs_5_2").addClass("d-none");

        } else if (value == '2') {
            const its = document.querySelectorAll('#kt_tabs_5_1 #ListParameters .itm');

            for (const i of its) {
                i.remove();

            }

            append_ItemFirstRow();


            $("#kt_tabs_5_1").addClass("d-none");
            $("#kt_tabs_5_2").removeClass("d-none");
        }
    });

    function append_ServiceFirstRow() {

        var html = ` <tr class="rowItemDetail align-items-center itm">

                                                                                        <td>
                                                                                            <input id="Dscription" class="form-control form-control-sm">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="input-group">
                                                                                                <input type="text" id="AcctCode" class="form-control form-control-sm" placeholder="GL Account" aria-describedby="basic-addon2">
                                                                                                <div id="GLAccountNo" class="input-group-append">
                                                                                                    <span class="input-group-text">
                                                                                                        <i class="la la-search"></i>
                                                                                                    </span>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input id="AcctName" class="form-control form-control-sm">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <select  class="form-control" id="VatGroup2" >
                                                                                           `+ vatGroupData + `
                                                                                            </select>

                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="TotalLC">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="BlanketAgreementNo">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>

                                                                                    </tr>`;

        $('#kt_repeater_2 tbody').append(html);
        //addDataInVatGroup();
    }

    function append_ItemFirstRow() {

        var html = `   <tr class="rowItemDetail align-items-center itm">
              <td>
                                                                                                    <input disabled="" id="LineNum" class="form-control form-control-sm NotReq" type="text">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                          <td>
        <div class="input-group">
            <input  id="ItemCode"  type="text" class="form-control form-control-sm" placeholder="Item No." aria-describedby="basic-addon2">
        <div id="Itemno" class="input-group-append">
        <span  class="input-group-text">
        <i class="la la-search"></i>
        </span>
        </div>
        </div>
        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
        </td>
                                                                            <td>
                                                                                <input class="form-control form-control-sm" id="ItemName" type = "text">
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                            <td>
                                                                                            <div class="input-group">
                                                                                                <select class="form-control" id="Warehouse">
                                                                                                    `+ WareHouseData + `
                                                                                                </select>

                                                                                            </div>


                                                                                        </td>
                                                                                         <td>
                                                                                            <input id="onHand" class="form-control form-control-sm" readonly type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                            <td>
                                                                                <input class="form-control form-control-sm" id = "QTY"  type = "number">
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                            <td>
                                                                                        <input readonly class="form-control form-control-sm NotReq" id="BaseQty"  type="number">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input readonly class="form-control form-control-sm NotReq" id="OpenQty"  type="number">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                            <td>
                                                                                <input class="form-control form-control-sm" id = "UPrc"  type = "number" >
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                            <td>
                                                                                <input class="form-control form-control-sm"  id = "DicPrc"   type = "number">
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                                                                    <td>

                                                                                                 <select  class="form-control" id="VatGroup" >
                                                                                           `+ vatGroupData + `
                                                                                            </select>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                            <td>
                                                                                <input class="form-control form-control-sm" id="TtlPrc" name="TotalLC" type='number' disabled >
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                            <td>
                                                                                <select class="form-control " id="UomEntry"></select><input id="UomCode" class="position-absolute d-none"/>
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>
                                                                      <td class="d-none">
                                                                                <select class="form-control form-control-sm" id="CountryOrg" name="DurationTypeCode">
                                                                                `+CountryData+`
                                                                                </select>
                                                                                <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                            </td>

                                                                           </tr>`;
        $('#kt_repeater_1 tbody').append(html);
        // addDataInVatGroup();
    }



    function GetVatGroupData() {
        $.get("SaleQuotation/GetVatGroupData", function (data) {
            vatGroupData = data;
            $.each(data, function () {

                vatGroupData = vatGroupData + "<option guid=" + this.rate + " value=" + this.code + ">" + this.vatName + "</option>";
            });
            //$("#VatGroup").select2();
            //$("#VatGroup2").select2();

        });
    }

    $(document).on('click', '#Itemno', function (e) {
        IsHeader = false;
        ObjItemCode = $(this).closest('tr').find("#ItemCode");
        DocModule = "S";
        generateItemTable();
        $('#myItemModal').modal('show');

    });


    $(document).on('click', '#CustomerNo', function (e) {
        ObjCardCode = $(this);

        generateCustomerTable();
        $('#myCustModal').modal('show');

    });
      $(document).on('input', '#ListBtnDelete,#Rounding,#Discount,#FooterTax', function (e) {
         GetPrice();        
     });

    $(document).on('change keyup', '#QTY,#UPrc,#DicPrc,#VatGroup,.VT_Option', function (e) {

        var Qty = $(this).closest('#ListParameters .itm').find('#QTY');
        var UPrc = $(this).closest('#ListParameters .itm').find('#UPrc');
        var DicPrc = $(this).closest('#ListParameters .itm').find('#DicPrc');
        var TtlPrc = $(this).closest('#ListParameters .itm').find('#TtlPrc');
        var VatGroup = $(this).closest('#ListParameters .itm').find('#VatGroup');
        let onHand = $(this).closest('#ListParameters .itm').find('#onHand');
        let OldQty = $(this).closest('#ListParameters .itm').find('#OldQty');

        var VatGuid = $('option:selected', VatGroup).attr("guid");
        let BaseQty = $(this).closest('#ListParameters .itm').find('#BaseQty');
        
           let _ItemCode = $(this).closest('#ListParameters .itm').find('#ItemCode').val()
        let _WhsCode = $(this).closest('#ListParameters .itm').find('#Warehouse').val()
      
        if(OldQty.val() != "" && OldQty.val() != undefined && OldQty.val() != null)
               {
                   
                   if( parseFloat( Qty.val() ) != parseFloat (OldQty.val()))
                   {
                       $(this).closest('tr').find('#ListbtnSelectBatch span i').removeClass("batch_is_valid");
                   }
                   else {
                       $(this).closest('tr').find('#ListbtnSelectBatch span i').addClass("batch_is_valid");
                   }
               }

        $.when( GetWhsAddedQty(_ItemCode, _WhsCode) ).then(function(sum) {
            if (Qty.val() <= 0) {
                Qty.val("");
                toastr.warning("Quantity can't be 0");
            } if (!(sum <= onHand.val())) {
                Qty.val("");
                toastr.warning("Quantity can't be greater than Warehouse quantity");
            }
       @* if ($(this).closest('#ListParameters .itm').find('#BaseQty').val() != "" && $(this).closest('#ListParameters .itm').find('#BaseQty').val() != '' && $(this).closest('#ListParameters .itm').find('#BaseQty').val() != null) {
            if (Number(Qty.val()) <= Number(BaseQty.val())) {

                $(this).closest('#ListParameters .itm').find('#OpenQty').val(BaseQty.val() - Qty.val());
            }
            else {

                toastr.warning("Quantity can't be greater than base quantity");
                Qty.val(0);
                $(this).closest('#ListParameters .itm').find('#OpenQty').val(BaseQty.val());


            }
        }
        if (!(Number(Qty.val()) <= Number(onHand.val()))) {
            toastr.warning("Quantity can't be greater than Quantity in Warehouse");
            Qty.val(0);
        }*@

        @*if ($(DicPrc).val() == "") {
             var Onepercent = parseFloat((parseFloat($(Qty).val()) * parseFloat($(UPrc).val())) / 100);
            var Tax = parseFloat(Onepercent * parseFloat(VatGuid));

            if (($(QTY).val() != null && $(UPrc).val() != null) || ($(QTY).val() != "" && $(UPrc).val() != "")) {
                $(TtlPrc).val((((parseFloat($(Qty).val()) * parseFloat($(UPrc).val())) + parseFloat(Tax)).toFixed(2)));
                GetPrice();
                //document.getElementById("TtlPrc").value = parseFloat(TtlPrc).toFixed(2);
                //console.log(TtlPrc)
            }
        }

        if ($(DicPrc).val() != "") {
            $(TtlPrc).val((parseFloat($(Qty).val()) * parseFloat($(UPrc).val())).toFixed(2));
             var Onepercent = parseFloat((parseFloat($(Qty).val()) * parseFloat($(UPrc).val())) / 100);
            var discountPrice = parseFloat(Onepercent * $(DicPrc).val());
            var Tax = parseFloat(Onepercent * parseFloat(VatGuid))
            console.log("discountPrice:", discountPrice)
            if (($(QTY).val() != null && $(UPrc).val() != null) || ($(QTY).val() != "" && $(UPrc).val() != "")) {
                $(TtlPrc).val((((parseFloat($(Qty).val()) * parseFloat($(UPrc).val())) - (parseFloat(discountPrice))) + (Tax)).toFixed(2));
                GetPrice();
                //document.getElementById("TtlPrc").value = parseFloat(TtlPrc).toFixed(2);
                //console.log(Tax)
            }
        }*@
          GetPrice();
        });
    });

    $(document).on('click', '#RoundingChkBox', function (e) {

        if ($(this).is(":checked")) {
            $('#Rounding').removeAttr('readonly', 'readonly');
        }
        else {
            $('#Rounding').attr('readonly', 'readonly');
        }
    });


      $(document).on('change keyup', '#Discount,#FooterTax', function (e) {
    GetPrice();



});



  

    var CountryData = ""
    var DOMStatus = '';
    var formid = '';
    var Guid = '';
    var ListValueType;
    var ListDurationType;
    var ListValueMethod;
    var ListParameter;
    var ListItemCodes;
    var isDuplicate = false;

    $(document).ready(function () { 
          DocModule = "S";
        Edit_GetUomGroup();
        InitializeWareHouseData();
     GetVatGroupData();
        GetCountrydata();
        display_ItemOrService();
        
        var date = new Date;
        DocModule = "S";
        
        GetContactPersons(CntctPerson);
        DocStatus(); 
          GetPrice();
            function InitializeWareHouseData() {

                $.get("Delivery/GetWareHouseData", function (data) {




                    $.each(data, function () {




                        WareHouseData += "<option  value='" + this.whscode + "'>" + this.whsname + "</option>";
                    });

                });
            }

        function Edit_GetUomGroup() {
        $('#ListParameters .itm').each(function (index, item) {
            
                    let ItemCode = $(this).find("#ItemCode").val();
                    let WhsCode = $(this).find("#Warehouse").val();
                    let onHand = $(this).find("#onHand");
                    let a = "";
                    $.get("Common/GetSelectedWareHouseData", { ItemCode: ItemCode, WhsCode: WhsCode }, function (data) {
                        onHand.val(data);
                    });

            ObjItemCode = $(this).find("#ItemCode");
            var itemno = $(this).find("#ItemCode").val();
            DocModule = "S";
            if (itemno != "" && itemno != null) { GetUomGroup(itemno); }


        });
    }

        
      function DocStatus() {

            if ("@ViewBag.Status" == "Closed") {

                $('body').each(function (index, item) {

                    $(this).find('input , select , textarea').each(function (index, data) {

                        $("#ListBtnAddd").addClass("d-none");
                        $("#ListBtnAddRM").addClass("d-none");
                        $(this).attr('disabled', true);

                    });
                })
                $("#Comments").attr('disabled', false);
                $("#NumAtCard").attr('disabled', false);
            }
            $("#btnSaveData").attr('disabled', false);
        }




        if (Guid != undefined && Guid != '' && Guid != null) {
            PopulateData();
        }

        $(document).on('change', '#ParamCode', function (e) {

            $(this).removeClass('is-invalid');
        });

        
    });


      function GetCountrydata() 
    {
	
	    $.get("SaleQuotation/GetCountries", function(data) 
        {				     
		    $.each(data, function() {					   
				    CountryData +="<option  value=" + this.country_code + ">" + this.country_name + "</option>";
		    });
		});
    }


    function display_ItemOrService() {
        if (Doctype == "1") {
            $("#kt_tabs_5_2").addClass("d-none")
        } else {
            $("#kt_tabs_5_1").addClass("d-none")
        }

    }



    $(document).on('change', '#ParamCode, #DurationTypeCode, #Duration,#EffectiveDate', function (e) {

        $(this).removeClass('is-invalid');
    });

    $(document).on('click', '#btnBack', function (e) {

        window.history.back();
    });

    $(document).on('click', '#btnDuplicate', function (e) {
        DocNumOnLoad();
        $(this).attr('disabled', true);
        isDuplicate = true;
        //  ValidateForm();
    });

    $(document).on('click', '#ListBtnDelete', function () {
        $(this).closest('tr').remove();
    })

    $(document).on('click', '#ListBtnDeleteRM', function () {
        $(this).closest('tr').remove();
    })

    $(document).on('click', '#ListBtnAddFile', function (e) {



        var html = `  <tr class="rowItemDetail align-items-center itm">

                                                                                    <td>
                                                                                        <input readonly type="file" id="selectedFile" class="position-absolute d-none form-control form-control-sm">
                                                                                        <input id="selectedFilePath" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input readonly id="selectedFileName" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <input readonly id="selectedFileDate" type="date" class="form-control form-control-sm">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                    </td>
                                                                                    <td>
                                                                                        <button id="btnbrowseFile" type="button" class="btn btn-light-primary font-weight-bold btn-sm"> <i class="la la-plus"></i> Browse </button>

                                                                                    </td>
                                                                                   <td>
                                                                            <a id = "ListBtnDelete" class="btn btn-bold btn-sm btn-light-danger">
                                                                            <i class="la la-trash"></i> X
                                                                           </a>
                                                                           </td>

                                                                                </tr> `;

        $('#kt_repeater_3 tbody').append(html);
    });
    $(document).on('keypress', '#CardCode,#DocNum,#CardName,#DocDate,#NumAtCard,#DocDue,#TaxDate,#ItemCode,#VatGroup,#GroupNum,#DocCur', function (e) {

        $(this).removeClass('is-invalid');
    });
    $(document).on('click', '#ListBtnAddd', function (e) {
        var html = `    <tr class="rowItemDetail align-items-center itm">
                                                                                        <td>
                                                                                                    <input
                                                                                                        disabled
                                                                                                        id="LineNum" class="form-control form-control-sm NotReq" type="text">
                                                                                                    <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="input-group">
                                                                                                <input id="ItemCode" type="text" class="form-control form-control-sm" placeholder="Item No." aria-describedby="basic-addon2">
                                                                                                <div id="Itemno" class="input-group-append">
                                                                                                    <span class="input-group-text">
                                                                                                        <i class="la la-search"></i>
                                                                                                    </span>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input id="ItemName" class="form-control form-control-sm"  type="text">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="input-group">
                                                                                                <select class="form-control" id="Warehouse">
                                                                                                    `+ WareHouseData + `
                                                                                                </select>
                                                                                                <div id="ListbtnSelectBatch" class="input-group-append d-none ">
                                                                                                           <span class="input-group-text">
                                                                                                               <i class="la la-warehouse "></i>
                                                                                                           </span>
                                                                                                </div>
                                                                                            </div>


                                                                                        </td>
                                                                                         <td>
                                                                                            <input id="onHand" class="form-control form-control-sm" readonly type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="QTY"  type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                        <input readonly class="form-control form-control-sm NotReq" id="BaseQty"  type="number">
                                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input readonly class="form-control form-control-sm NotReq" id="OpenQty"  type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="UPrc"  type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm NotReq" id="DicPrc"  type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>


                                                                                            <select  class="form-control jsSelect2" id="VatGroup">
                                                                                           `+ vatGroupData + `
                                                                                            </select>


                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
    @*<input class="form-control form-control-sm" id="VatGroup" onkeyup="GetPrice()" type="number">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>*@
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="TtlPrc" name="TotalLC" type='number' disabled>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                           <select class="form-control" id="UomEntry"> </select><input id="UomCode" class="position-absolute d-none"/>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                      <td class="d-none">
                                                                                            <select class="form-control form-control-sm" id="CountryOrg" name="DurationTypeCode">
                                                                                                  `+CountryData+`
                                                                                            </select>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                            <a id = "ListBtnDelete" class="btn btn-bold btn-sm btn-light-danger">
                                                                            <i class="la la-trash"></i> X
                                                                           </a>
                                                                           </td>
                                                                                    </tr>`;
        $('#kt_repeater_1 tbody').append(html);
        //$('#VatGroup').select2('destroy');
        //$('.jsSelect2').select2();
        // addDataInVatGroup();
    });
       $(document).on('change', '#UomEntry', function (e) 
    {
        
        let UomCode =  $(this).find("option:selected").text();
        console.log($(this).closest('tr').find("#UomCode"));
        $(this).closest('tr').find("#UomCode").val(""+UomCode+"");
       
    });
    $(document).on('click', '#ListBtnAddRM', function (e) {

        var html = ` <tr class="rowItemDetail align-items-center itm">

                                                                                        <td>
                                                                                            <input id="Dscription" class="form-control form-control-sm">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="input-group">
                                                                                                <input type="text" id="AcctCode" class="form-control form-control-sm" placeholder="GL Account" aria-describedby="basic-addon2">
                                                                                                <div id="GLAccountNo" class="input-group-append">
                                                                                                    <span class="input-group-text">
                                                                                                        <i class="la la-search"></i>
                                                                                                    </span>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input id="AcctName" class="form-control form-control-sm">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <select  class="form-control" id="VatGroup2" >
                                                                                           `+ vatGroupData + `
                                                                                            </select>

                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="TotalLC">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input class="form-control form-control-sm" id="BlanketAgreementNo">
                                                                                            <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                                        </td>
                                                                                          <td>
                                                                            <a id = "ListBtnDelete" class="btn btn-bold btn-sm btn-light-danger">
                                                                            <i class="la la-trash"></i> X
                                                                           </a>
                                                                           </td>
                                                                                    </tr>`;

        $('#kt_repeater_2 tbody').append(html);
        //addDataInVatGroup();
    });

    $(document).on('click', '#btnSave', function (e) {

        $('#btnSave').addClass('kt-spinner kt-spinner--right kt-spinner--md kt-spinner--light');
        $('#btnSave').attr('disabled', true);

        ValidateForm();
    });

    function GetListValueType() {

        return $.ajax({
            url: '/LabTemplate/GetListValueType',
            dataType: 'json',
            type: 'Get',
            async: false,
            success: function (result) {


            },
            error: function (jqXhr, textStatus, errorMessage) {
                console.log(errorMessage);
            }

        }).done(function (result) {

            result = result.data;
            console.log(result)

            var html = '';
            for (var i = 0; i < result.length; i++) {
                $('#ValueTypeCode').append('<option value="' + result[i].valueTypeCode + '">' + result[i].valueTypeDescription + ' </option>');
                $('#LengthValueType').append('<option value="' + result[i].valueTypeCode + '">' + result[i].valueTypeDescription + ' </option>');
                $('#WidthValueType').append('<option value="' + result[i].valueTypeCode + '">' + result[i].valueTypeDescription + ' </option>');
                html += '<option value="' + result[i].valueTypeCode + '">' + result[i].valueTypeDescription + ' </option>';
                ListValueType = html;
            }


        });
    }

    function GetListDurationType() {

        return $.ajax({
            url: '/LabTemplate/GetListDurationType',
            dataType: 'json',
            type: 'Get',
            async: false,
            success: function (result) {


            },
            error: function (jqXhr, textStatus, errorMessage) {
                console.log(errorMessage);
            }

        }).done(function (result) {

            result = result.data;
            console.log(result)
            var html = '';
            for (var i = 0; i < result.length; i++) {
                $('#DurationTypeCode').append('<option value="' + result[i].durationTypeCode + '">' + result[i].durationTypeDescription + ' </option>');
                html += '<option value="' + result[i].durationTypeCode + '">' + result[i].durationTypeDescription + ' </option>';
                ListDurationType = html;
            }


        });
    }

   


    

    $(document).on('click', '#btnSaveData', function (e) {
        $(this).addClass('kt-spinner kt-spinner--right kt-spinner--md kt-spinner--light');
        $(this).attr('disabled', true);
        if (
            ValidateData("HeaderForm")
                && ItemServiceType == '1' ? ValidateListData("ListParameters .itm") : ValidateListData("ListParameters2 .itm")
            && ValidateData("kt_tabs_acct")
        )
            FormData();
        else {
            $(this).removeClass('kt-spinner kt-spinner--right kt-spinner--md kt-spinner--light');
            $(this).attr('disabled', false);
        }
    });


    function ValidateData(element) {

        let isValid = [];

        $('#' + element + ' input,' + '#' + element + ' select, ' + '#' + element + ' textarea').each(function (index, data) {

            if (!($(this).hasClass("NotReq"))) {
                if ($(this).attr("id") != undefined || $(this).attr("id") != "" || $(this).attr("id") != '') {
                    if ($(this).val() == null || $(this).val() == '' || $(this).val() == undefined) {
                        $(this).addClass('is-invalid');
                        isValid.push(false);
                    }
                    else {
                        $(this).removeClass('is-invalid');
                        isValid.push(true);
                    }

                }
            }
        });

        if (isValid.includes(false))
            return false;
        else
            return true;

    }

     function ValidateListData(element) {
        let isValid = [];

        $('#' + element).each(function (index, item) {

            $(this).find('input , select , textarea').each(function (index, data) {

                if(!($(this).hasClass("NotReq"))) 
                {
                if ($(this).attr("id") != undefined || $(this).attr("id") != "" || $(this).attr("id") != '') {
                    if ($(this).val() == null || $(this).val() == '' || $(this).val() == undefined) {
                        $(this).addClass('is-invalid');
                        isValid.push(false);
                    }
                    else {
                        $(this).removeClass('is-invalid');
                        isValid.push(true);
                    }
                }
                }
            });

        });


        if (isValid.includes(false))
            return false;
        else
            return true;
    }

    function FormData() {


        var data =
        {
            ID: $("#my_id").val(),
            HeaderData: getJsonObj("HeaderForm"),
            ListAccouting: getJsonObj("kt_tabs_acct"),
            ListItems: ItemServiceType == '1' ? getJsonObjList("ListParameters .itm") : null,
            ListService: ItemServiceType == '2' ? getJsonObjList("ListParameters2 .itm") : null,
            ListAttachment: getJsonObjList("ListParameters3 .itm"),
            FooterData: getJsonObj("FooterData")

        }


        PostData(data);


    }

    function PostData(formData) {



        return $.ajax({
            url: '/ARCreditMemo/EditARCreditMemo',
            dataType: 'json',
            type: 'POST',

            data: { formData: JSON.stringify(formData) },

            success: function (result) {

                if (result.isInserted) {
                    toastr.success(result.message);

                    setTimeout(
                        function () {

                            $('#btnSaveData').removeClass('kt-spinner kt-spinner--right kt-spinner--md kt-spinner--light');
                            $('#btnSaveData').attr('disabled', false);

                        }, 800);
                    setTimeout(function () {
                        window.history.back();
                    }, 800);


                }

                if (!(result.isInserted)) {
                    toastr.error(result.message);
                    $('#btnSaveData').removeClass('kt-spinner kt-spinner--right kt-spinner--md kt-spinner--light');
                    $('#btnSaveData').attr('disabled', false);

                }

            },
            error: function (jqXhr, textStatus, errorMessage) {
                console.log(errorMessage);
            }

        }).done(function (result) {

        });
    }

    function getJsonObj(element) {

        var jsonobj = new Object();



        $('#' + element + ' input,' + '#' + element + ' select, ' + '#' + element + ' textarea').each(function (index, data) {

            if ($(this).attr("id") != undefined || $(this).attr("id") != "" || $(this).attr("id") != '')
                jsonobj[$(this).attr("id")] = $(this).val();

        });
        return jsonobj;
    }

    function getJsonObjList(element) {
        let listObj = [];

        $('#' + element).each(function (index, item) {
            var jsonobj = new Object();
            $(this).find('input , select , textarea').each(function (index, data) {

                if ($(this).attr("id") != undefined || $(this).attr("id") != "" || $(this).attr("id") != '')
                    jsonobj[$(this).attr("id")] = $(this).val();

            });

            listObj.push(jsonobj);



        })
        return listObj;
    }


</script>
