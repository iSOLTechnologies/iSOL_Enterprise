@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    ViewBag.title1 = "";
    ViewBag.title2 = "SaleOrderWise Yarn Report";
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Render Body <Start> -->
<!--begin::Subheader-->
<script src="~/Assets/plugins/global/plugins.bundle.js"></script>

<link href="~/css/commonstyle.css" rel="stylesheet" />
<!--end::Subheader-->
<!--begin::Entry-->
<input type="hidden" id="PageGuid" value="@Context.Request.Query["Source"]" />

<div class="container-fluid mt-5">

    <!--begin::Card-->
    <div class="card card-custom">
        <div class="card-header">
            <div class="card-title">
                <span class="card-icon">
                    <i class="flaticon-notepad text-primary"></i>
                </span>
                <h3 class="card-label">SaleOrderWise Yarn Report</h3>
            </div>
            @* <div class="card-toolbar">
            <button class="bt btn-brand"  type="button">
            Add
            </button>

            <!--end::Button-->
            </div>*@

        </div>
        <div class="card-body ">
            <!--begin: Datatable-->
            <div class="row">
                <div class="col-md-4 d-flex">
                    <label>Date From </label>
                    <input type="date" class="form-control form-control-sm" id="DtFrom" />

                </div>
                <div class="col-md-4 d-flex">
                    <label>Date To </label>
                    <input type="date" class="form-control form-control-sm" id="DtTo" />

                </div>
                <div class="col-md-2">
                    <button type="button" id="btnGenerateReport" class="btn btn-primary font-weight-bolder btnView">
                        + Get Report
                    </button>
                </div>
            </div>


            <div class="loading_ic">

                <div class="spinner-border text-primary">
                    <span class="sr-only">Loading...</span>

                </div>


            </div>



            <!--end: Datatable-->
        </div>
    </div>

</div>
<!--end::Entry-->
<!-- Render Body <End> -->

<script src="~/js/commonindex.js"></script>
<script>
    var Guid = $('#PageGuid').val();

    $(document).ready(function () {

        Guid.GetUserPageActivity();

    });
    $(document).on('click', '#btnGenerateReport', function () {

        if ($('#DtFrom').val() != null &&
            $('#DtFrom').val() != "" && 
            $('#DtFrom').val() != undefined &&
            $('#DtTo').val() != null &&
            $('#DtTo').val() != "" &&
            $('#DtTo').val() != undefined
           ) 
        {

            $(this).attr('disabled', true);

            $(".loading_ic").addClass('overlay');
            $(".loading_ic").show();

            $.ajax({
                url: '@ViewBag.Url' + 'Report/SaleOrderWiseYarnReport',
                type: 'GET',
                dataType: 'json',
                async: true,
                data: { DateFrom: $('#DtFrom').val(), DateTo: $('#DtTo').val() },
                success: function (result) 
                {
                    $('#btnGenerateReport').attr('disabled', false);
                    $(".loading_ic").removeClass('overlay dark');
                    $(".loading_ic").hide();

                    if (result.isSuccess) {
                        window.open('@ViewBag.Url' + result.Data, '_blank');
                    }
                    else if (result.isError) {
                        toastr.error("An Error Occurred in Report Generation !!");
                    }




                },
                error: function (jqXhr, textStatus, errorMessage) {
                    $(".loading_ic").removeClass('overlay dark');
                    $(".loading_ic").hide();
                    console.log(errorMessage);
                }
            });

        }
        else {
            toastr.warning("Date From & Date To can't be empty")
        }
    });


</script>
