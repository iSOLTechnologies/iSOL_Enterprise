@{
    ViewBag.title1 = "Planning Sheet / ";
    ViewBag.title2 = "New";
    ViewData["Title"] = "Planning Sheet Master";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model iSOL_Enterprise.Models.RoleModels

@using Microsoft.AspNetCore.Http

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

<!-- Render Body <Start> -->

<div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid mt-4">

    <!--end::Subheader-->
    <!--begin::Entry-->
    <div class="container">
        <!--begin::Card-->
        <div class="card card-custom card-sticky" id="kt_page_sticky_card">
            <div class="card-header">
                <div class="card-title">
                    <h3 class="card-label">
                        Add Details
                        <i class="mr-2"></i>
                        <!-- <small class="">try to scroll the page</small> -->
                    </h3>
                </div>
                <div class="card-toolbar">
                    <a onclick="Back_his()" class="btn btn-light-primary font-weight-bolder mr-2">
                        <i class="ki ki-long-arrow-back icon-sm"></i>Back
                    </a>
                    <div class="btn-group">

                        <button type="button" class="btn btn-primary font-weight-bolder" id="btnSaveData">
                            <i class="ki ki-check icon-sm"></i>Save
                        </button>

                    </div>
                </div>
            </div>
            <div class="card-body">
                <!--begin::Form-->
                <form class="form" id="kt_form">


                    <input type="hidden" value="@Context.Session.GetString("Name")" id="sessionName" />
                    <input type="hidden" value="@Context.Session.GetString("Email")" id="sessionEmail" />
                    <input type="hidden" value="@Context.Session.GetString("RoleCode")" id="UserRoleCode" />
                    <input type="hidden" value="@Context.Session.GetString("DepartmentCode")" id="_DepartmentCode" />

                    <input type="hidden" value="@Context.Request.Query["Id"]" id="Guid" />
                    <input type="hidden" value="@Context.Request.Query["Source"]" id="PageGuid" />
                    <input type="hidden" value="@Context.Request.Query["DocType"]" id="DocType" />
                    <input type="hidden" value="@Context.Request.Query["DOM"]" id="DOMStatus" />

                    <input type="hidden" value="@Context.Session.GetInt32("UserId")" id="_UserId" />
                    <style>
                        .mr2 {
                            margin: 0% 2% 0% 2%;
                            /*width: 5%;*/
                        }

                        .cr2 {
                            margin: 0% 1% 0% 0%;
                            width: 5%;
                        }

                        .wdth {
                            width: 250% !important;
                        }

                        #kt_repeater_1 {
                            border-collapse: collapse;
                            width: 100%;
                            overflow-x: scroll;
                            display: block;
                        }

                        .ScrollThead,
                        .ScrollTbody {
                            display: inline-block;
                        }

                        .ScrollTbody {
                            overflow-y: auto;
                            overflow-x: hidden;
                            max-height: 800px;
                        }

                            .ScrollTbody td, .ScrollThead
                            th {
                                min-width: 160px;
                                max-width: 160px;
                                height: 40px;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            }

                        .ScrollTbody2 td, .ScrollThead2
                        th {
                            min-width: 100px;
                            max-width: 160px;
                            height: 40px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }

                        .loading_ic {
                            /*opacity: 0;*/
                           display: none;

                        }
                        .mycont > .overlay {
                            height: 100%;
                            left: 0;
                            position: absolute;
                            top: 0;
                            width: 100%;
                            border-radius: 0.25rem;
                            -ms-flex-align: center;
                            align-items: center;
                            background-color: rgba(255, 255, 255, 0.7);
                            display: -ms-flexbox;
                            display: flex;
                            -ms-flex-pack: center;
                            justify-content: center;
                            z-index: 50;
                        }
                        /*.spinner-border {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: white;
                            padding: 20px;
                        }*/
                    </style>
                    <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">
                        <div class="row">
                            <div class="col-lg-12 mycont">
                                <!--begin::Portlet-->
                                <div class="kt-portlet kt-portlet--last kt-portlet--head-lg kt-portlet--responsive-mobile" id="kt_page_portlet">

                                    <div class="kt-portlet__body">
                                        <form autocomplete="off" role="form" class="kt-form" id="F_@Context.Request.Query" name="F_@Context.Request.Query["Source"]">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <div class="kt-section kt-section--first">
                                                        <div class="kt-section__body">


                                                            @* ----------   Header -----------*@
                                                            <div id="HeaderForm">
                                                                <div class="form-group row justify-content-between">

                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Planning Date</label>

                                                                        <input id="PlanningDateHeader" type="date" class="d form-control form-control-sm">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>

                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Status</label>

                                                                        <input type="text" id="StatusHeader" class="form-control form-control-sm NotReq" placeholder="Status">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                    <div class="col-md-3 d-flex">
                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Sale Order #</label>
                                                                        <input type="number" id="saleorderno" class="form-control form-control-sm NotReq" placeholder="0.00000">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Customer Code</label>

                                                                        <input type="text" id="CustomerCodeHeader" class="form-control form-control-sm NotReq">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>

                                                                </div>

                                                                <div class="form-group row justify-content-between">
                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">SO Date</label>

                                                                        <input id="SaleOrderDateHeader" type="date" class="d form-control form-control-sm">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>

                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Shipment Date</label>

                                                                        <input id="ShipmentDateHeader" type="date" class="d form-control form-control-sm">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Item Code</label>

                                                                        <input type="text" id="Status" class="form-control form-control-sm NotReq">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Item Name</label>

                                                                        <input type="text" id="Status" class="form-control form-control-sm NotReq">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                </div>


                                                                <div class="form-group row ">
                                                                    <div class="col-md-3 d-flex">
                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">Quantity</label>
                                                                        <input type="number" id="QuantityHeader" class="form-control form-control-sm NotReq" placeholder="0.00000">
                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>
                                                                    <div class="col-md-3 d-flex">

                                                                        <label class="mr-2 d-flex text-center pt-2 col-md-5">UOM</label>

                                                                        <input type="text" id="uom" class="form-control form-control-sm NotReq">


                                                                        <div id="ErrorMsg" class="error invalid-feedback">This field is required.</div>
                                                                    </div>


                                                                </div>



                                                            </div>

                                                            <div class="kt-separator kt-separator--space-md kt-separator--border-dashed"></div>



                                                            <ul class="nav nav-tabs nav-tabs-line nav-tabs-bold nav-tabs-line-3x nav-tabs-line-brand" role="tablist">

                                                                <li class="nav-item ">
                                                                    <a class="nav-link active" data-toggle="tab" href="#kt_tabs_Dates" role="tab">Dates</a>
                                                                </li>

                                                            </ul>

                                                            <div class="tab-content" style="height:150px">


                                                                @*Tab  kt_tabs_SellingPrice*@
                                                                <div class="tab-pane scrollbar active" id="kt_tabs_Dates" role="tabpanel" style="overflow:auto">
                                                                    <table id="kt_repeater_6">
                                                                        <thead class="ScrollThead mt-3">
                                                                            <tr>
                                                                                <th class="text-center">
                                                                                    Planning Date
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Precosting Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Precosting Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    PO Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    PO Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Audit Approval Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Audit Approval Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Purchase Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Purchase Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Delivery Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Delivery Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Issuance For Sizing Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Yarn Issuance For Sizing Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Sized Yarn Received Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Sized Yarn Received Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Sized Yarn Issuance For Greige Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Sized Yarn Issuance For Greige Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Greige Received Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Greige Received Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Greige Issuance for Dyed Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Greige Issuance for Dyed Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Dyed Receiving Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Dyed Receiving Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Dyed Issuance For Prod Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Dyed Issuance For Prod Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Packing Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Packing Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Delivery Note Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Delivery Note Actual
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Gate Pass Planned
                                                                                </th>
                                                                                <th class="text-center">
                                                                                    Gate Pass Actual
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="ListParameters" data-repeater-list="" class="ScrollTbody pb-2">

                                                                            <tr class="rowItemDetail align-items-center Pile1">
                                                                                <td>
                                                                                    <input id="ListPlanningDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                 <td>
                                                                                    <input id="PreCostingPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                 <td>
                                                                                    <input id="PreCostingActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>

                                                                                 <td>
                                                                                    <input id="POPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="POActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                 <td>
                                                                                    <input id="AuditApprovalPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="AuditApprovalActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="YarnPurchasePlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="YarnPurchaseActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="YarnDeliveryPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>

                                                                                <td>
                                                                                    <input id="YarnDeliveryActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="YarnIssuanceForSizzingPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="YarnIssuanceForSizzingActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="SizedYarnReceivedPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="SizedYarnReceivedActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="SizedYarnIssuanceForGreigePlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="SizedYarnIssuanceForGreigeActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>

                                                                                <td>
                                                                                    <input id="GreigeReceivingPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="GreigeReceivingActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="GreigeIssuanceForDyedPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="GreigeIssuanceForDyedActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="DyedReceivingPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="DyedReceivingActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="DyedIssuanceForProdPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>

                                                                                <td>
                                                                                    <input id="DyedIssuanceForProdActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="PackingPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="PackingActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="DeliveryNotePlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="DeliveryNoteAcutalDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="GatePassPlannedDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                                <td>
                                                                                    <input id="GatePassActualDate" type="date" class="form-control form-control-sm">
                                                                                </td>
                                                                            </tr>

                                                                            
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <!--end::Portlet-->
                                <div class="loading_ic">
                                    
                                    <div class="spinner-border text-primary">
                                    <span class="sr-only">Loading...</span>
                                    @*@*<i class="fas fa-2x fa-sync-alt"></i>*@
                                    </div>
                                        @*<span class="">Loading...</span>*@

                                </div>
                            </div>
                        </div>
                    </div>

                </form>
                <!--end::Form-->
            </div>
        </div>
        <!--end::Card-->

    </div>
    <!--end::Entry-->
</div>
<!-- Render Body <End> -->
<script src="~/Assets/plugins/global/plugins.bundle.js"></script>
<script src="~/Assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
<script src="~/Assets/js/scripts.bundle.js"></script>
<script src="~/js/commonmethods.js"></script>

<script>
    //var vatGroupData = "";
    var ItemServiceType = '1';
    const boxes = document.querySelectorAll('.d');

    for (const box of boxes) {
        box.value = new Date().toJSON().slice(0, 10);
    }


    $(document).on("input", "input[type='number']", function () {
        var value = parseFloat(this.value);
        if (isNaN(value)) {
            return;
        }
        var decimalCount = (this.value.split(".")[1] || []).length;
        if (decimalCount > 3) {
            this.value = value.toFixed(3);
        }
    });





    $(document).on('click', '#Itemno', function (e) {
        IsHeader = false;
        ObjItemCode = $(this).closest('tr').find("#ItemCode");
        DocModule = "S";
        generateItemTable();
        $('#myItemModal').modal('show');

    });


    $(document).on('click', '#btnBack', function (e) {

        window.history.back();
    });

    $(document).on('keyup', '#saleorderno', function (e) {
        $(".loading_ic").addClass('overlay');
        $(".loading_ic").show();
        $.get("PlanningSheet/GetData", {SONumber : $(this).val()} ,function(data) 
        {
            let list = JSON.parse(data.docData);
         
            if(data.success) 
            {
                
                $.each(list,function() {
                    
                    $("#" + this.Key).val(this.Value);
                });
                $(".loading_ic").removeClass('overlay dark');
                $(".loading_ic").hide();
            }
            else {
                $(".loading_ic").removeClass('overlay dark');
                $(".loading_ic").hide();
            }
            
        });
        
    });

    $(document).on('click', '#ListBtnDelete', function () {
        $(this).closest('tr').remove();
    })


</script>
